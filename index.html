<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Pathway Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .8; }
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        .animate-slideIn { animation: slideIn 0.3s ease-out; }
        .hover\:scale-105:hover { transform: scale(1.05); }
        .hover\:scale-102:hover { transform: scale(1.02); }
        .course-card { transition: all 0.3s ease; }
        .grade-btn { transition: all 0.2s ease; }
        .flowchart-node { transition: all 0.3s ease; }
        .flowchart-line { stroke-dasharray: 5; animation: dash 1.5s linear infinite; }
        @keyframes dash { to { stroke-dashoffset: -10; } }
    </style>
</head>
<body class="bg-slate-900">
    <div id="app"></div>

    <script>
        const state = {
            playerName: '',
            selectedMajor: '',
            courses: [],
            showSetup: true,
            level: 1,
            xp: 0,
            chatbot: {
                active: true,
                currentStep: 0,
                completed: false,
                responses: {
                    studyType: '',
                    preferredTime: '',
                    plannedCourses: 0,
                    plannedSemesters: 0
                }
            },
            progress: {
                plannedCourses: 0,
                plannedSemesters: 0,
                actualCourses: 0,
                actualSemesters: 0
            },
            teacherRecommendations: [],
            professorSearch: {
                active: false,
                query: '',
                results: []
            }
        };

        const majors = [
            { id: 'cs', name: 'Computer Science', icon: 'üíª', color: 'from-blue-500 to-cyan-500', description: 'Master algorithms, programming, and software development' },
            { id: 'eng', name: 'Engineering', icon: '‚öôÔ∏è', color: 'from-orange-500 to-red-500', description: 'Design and build innovative solutions to complex problems' },
            { id: 'bio', name: 'Biology', icon: 'üß¨', color: 'from-green-500 to-emerald-500', description: 'Explore the science of life and living organisms' },
            { id: 'bus', name: 'Business', icon: 'üíº', color: 'from-purple-500 to-pink-500', description: 'Develop skills for leadership and organizational success' },
            { id: 'art', name: 'Arts', icon: 'üé®', color: 'from-yellow-500 to-orange-500', description: 'Cultivate creativity and artistic expression' },
            { id: 'math', name: 'Mathematics', icon: 'üìê', color: 'from-indigo-500 to-purple-500', description: 'Dive into the language of numbers and abstract reasoning' },
        ];

        // Enhanced course structure with prerequisites
        const courseTemplates = {
            cs: {
                core: [
                    { 
                        name: 'Intro to Programming', 
                        credits: 3, 
                        difficulty: 1, 
                        description: 'Learn the fundamentals of coding and problem-solving', 
                        prerequisites: [], 
                        semester: 1 
                    },
                    { 
                        name: 'Discrete Mathematics', 
                        credits: 3, 
                        difficulty: 2, 
                        description: 'Mathematical foundations for computer science', 
                        prerequisites: [], 
                        semester: 1 
                    },
                    { 
                        name: 'Calculus I', 
                        credits: 4, 
                        difficulty: 2, 
                        description: 'Introduction to differential and integral calculus', 
                        prerequisites: [], 
                        semester: 1 
                    },
                    { 
                        name: 'Data Structures', 
                        credits: 4, 
                        difficulty: 2, 
                        description: 'Master efficient ways to store and organize data', 
                        prerequisites: ['Intro to Programming'], 
                        semester: 2 
                    },
                    { 
                        name: 'Computer Systems', 
                        credits: 3, 
                        difficulty: 2, 
                        description: 'Understanding computer architecture and organization', 
                        prerequisites: ['Intro to Programming'], 
                        semester: 2 
                    },
                    { 
                        name: 'Calculus II', 
                        credits: 4, 
                        difficulty: 3, 
                        description: 'Advanced techniques of integration and series', 
                        prerequisites: ['Calculus I'], 
                        semester: 2 
                    },
                    { 
                        name: 'Algorithms', 
                        credits: 4, 
                        difficulty: 3, 
                        description: 'Design and analyze computational procedures', 
                        prerequisites: ['Data Structures', 'Discrete Mathematics'], 
                        semester: 3 
                    },
                    { 
                        name: 'Database Systems', 
                        credits: 3, 
                        difficulty: 2, 
                        description: 'Understand how to store and retrieve information efficiently', 
                        prerequisites: ['Data Structures'], 
                        semester: 3 
                    },
                    { 
                        name: 'Linear Algebra', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Study vectors, matrices, and linear transformations', 
                        prerequisites: ['Calculus I'], 
                        semester: 3 
                    },
                    { 
                        name: 'Software Engineering', 
                        credits: 4, 
                        difficulty: 3, 
                        description: 'Learn professional software development practices', 
                        prerequisites: ['Data Structures', 'Algorithms'], 
                        semester: 4 
                    },
                    { 
                        name: 'Operating Systems', 
                        credits: 4, 
                        difficulty: 4, 
                        description: 'Study system software and resource management', 
                        prerequisites: ['Computer Systems', 'Algorithms'], 
                        semester: 4 
                    },
                    { 
                        name: 'Senior Project', 
                        credits: 3, 
                        difficulty: 4, 
                        description: 'Apply your skills to a comprehensive capstone project', 
                        prerequisites: ['Software Engineering'], 
                        semester: 4 
                    }
                ],
                electives: [
                    { 
                        name: 'Web Development', 
                        credits: 3, 
                        difficulty: 2, 
                        description: 'Build interactive websites and web applications', 
                        prerequisites: ['Intro to Programming'], 
                        semester: 3 
                    },
                    { 
                        name: 'Machine Learning', 
                        credits: 4, 
                        difficulty: 4, 
                        description: 'Explore AI systems that learn from data', 
                        prerequisites: ['Algorithms', 'Linear Algebra'], 
                        semester: 4 
                    },
                    { 
                        name: 'Mobile App Development', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Create applications for mobile devices', 
                        prerequisites: ['Data Structures'], 
                        semester: 3 
                    },
                    { 
                        name: 'Cybersecurity', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Learn to protect systems from digital attacks', 
                        prerequisites: ['Computer Systems', 'Algorithms'], 
                        semester: 4 
                    },
                    { 
                        name: 'Game Development', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Design and create interactive games', 
                        prerequisites: ['Data Structures'], 
                        semester: 4 
                    },
                    { 
                        name: 'Cloud Computing', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Work with distributed computing systems', 
                        prerequisites: ['Computer Systems'], 
                        semester: 4 
                    },
                    { 
                        name: 'Computer Networks', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Study network protocols and architectures', 
                        prerequisites: ['Computer Systems'], 
                        semester: 4 
                    },
                    { 
                        name: 'Artificial Intelligence', 
                        credits: 4, 
                        difficulty: 4, 
                        description: 'Explore intelligent systems and agents', 
                        prerequisites: ['Algorithms', 'Linear Algebra'], 
                        semester: 4 
                    },
                    { 
                        name: 'Advanced Programming Techniques', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Master advanced programming concepts and paradigms', 
                        prerequisites: ['Data Structures', 'Algorithms'], 
                        semester: 4 
                    }
                ]
            },
            eng: {
                core: [
                    { 
                        name: 'Engineering Mechanics', 
                        credits: 4, 
                        difficulty: 2, 
                        description: 'Study forces and motion in engineering systems', 
                        prerequisites: [], 
                        semester: 1 
                    },
                    { 
                        name: 'Calculus for Engineers', 
                        credits: 4, 
                        difficulty: 2, 
                        description: 'Advanced mathematics for engineering applications', 
                        prerequisites: [], 
                        semester: 1 
                    },
                    { 
                        name: 'Physics I: Mechanics', 
                        credits: 4, 
                        difficulty: 2, 
                        description: 'Fundamental principles of mechanical physics', 
                        prerequisites: [], 
                        semester: 1 
                    },
                    { 
                        name: 'Circuit Analysis', 
                        credits: 4, 
                        difficulty: 2, 
                        description: 'Analyze electrical circuits and components', 
                        prerequisites: ['Calculus for Engineers'], 
                        semester: 2 
                    },
                    { 
                        name: 'Materials Science', 
                        credits: 3, 
                        difficulty: 2, 
                        description: 'Explore properties and applications of materials', 
                        prerequisites: ['Physics I: Mechanics'], 
                        semester: 2 
                    },
                    { 
                        name: 'Physics II: Electricity', 
                        credits: 4, 
                        difficulty: 3, 
                        description: 'Principles of electricity and magnetism', 
                        prerequisites: ['Physics I: Mechanics', 'Calculus for Engineers'], 
                        semester: 2 
                    },
                    { 
                        name: 'Thermodynamics', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Understand energy transfer and conversion processes', 
                        prerequisites: ['Calculus for Engineers', 'Physics I: Mechanics'], 
                        semester: 3 
                    },
                    { 
                        name: 'Fluid Mechanics', 
                        credits: 4, 
                        difficulty: 3, 
                        description: 'Study behavior of liquids and gases in motion', 
                        prerequisites: ['Engineering Mechanics', 'Calculus for Engineers'], 
                        semester: 3 
                    },
                    { 
                        name: 'Differential Equations', 
                        credits: 4, 
                        difficulty: 3, 
                        description: 'Solve equations involving rates of change', 
                        prerequisites: ['Calculus for Engineers'], 
                        semester: 3 
                    },
                    { 
                        name: 'Control Systems', 
                        credits: 4, 
                        difficulty: 3, 
                        description: 'Design systems that regulate themselves automatically', 
                        prerequisites: ['Circuit Analysis', 'Differential Equations'], 
                        semester: 4 
                    },
                    { 
                        name: 'Engineering Design', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Principles of engineering design and innovation', 
                        prerequisites: ['Materials Science', 'Fluid Mechanics'], 
                        semester: 4 
                    },
                    { 
                        name: 'Senior Capstone', 
                        credits: 4, 
                        difficulty: 4, 
                        description: 'Complete a comprehensive engineering design project', 
                        prerequisites: ['Engineering Design', 'Control Systems'], 
                        semester: 4 
                    }
                ],
                electives: [
                    { 
                        name: 'Robotics', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Design and program robotic systems', 
                        prerequisites: ['Control Systems'], 
                        semester: 4 
                    },
                    { 
                        name: 'Renewable Energy', 
                        credits: 3, 
                        difficulty: 2, 
                        description: 'Study sustainable energy technologies', 
                        prerequisites: ['Thermodynamics'], 
                        semester: 4 
                    },
                    { 
                        name: 'Biomedical Engineering', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Apply engineering to medical challenges', 
                        prerequisites: ['Materials Science'], 
                        semester: 3 
                    },
                    { 
                        name: 'Structural Analysis', 
                        credits: 3, 
                        difficulty: 3, 
                        description: 'Analyze and design structural systems', 
                        prerequisites: ['Engineering Mechanics'], 
                        semester: 4 
                    }
                ]
            }
        };

        // Updated teacher database with specified professor names
        const teachers = {
            cs: [
                {
                    name: "Prof. Robert Eckman",
                    title: "Professor of Computer Science",
                    specialty: "Programming & Software Development",
                    rating: 4.8,
                    difficulty: "Medium",
                    teachingStyle: "Interactive lectures with hands-on coding",
                    availability: ["Morning", "Afternoon"],
                    recommendedFor: ["Full-time students", "Beginners"],
                    courses: ["Intro to Programming", "Software Engineering"],
                    bio: "15+ years teaching programming fundamentals. Focuses on building strong coding foundations.",
                    image: "üë®‚Äçüíº"
                },
                {
                    name: "Prof. Louise Yan",
                    title: "Associate Professor of Mathematics",
                    specialty: "Discrete Mathematics & Data Structures",
                    rating: 4.7,
                    difficulty: "Medium-High",
                    teachingStyle: "Clear explanations with practical applications",
                    availability: ["Morning", "Flexible"],
                    recommendedFor: ["Detail-oriented students", "Math enthusiasts"],
                    courses: ["Discrete Mathematics", "Data Structures", "Algorithms"],
                    bio: "PhD in Computational Mathematics. Makes abstract concepts accessible and applicable.",
                    image: "üë©‚Äçüè´"
                },
                {
                    name: "Prof. Francki Elve",
                    title: "Professor of Mathematics",
                    specialty: "Calculus & Mathematical Analysis",
                    rating: 4.6,
                    difficulty: "Medium",
                    teachingStyle: "Step-by-step problem solving with real-world examples",
                    availability: ["Afternoon", "Evening"],
                    recommendedFor: ["Visual learners", "Problem solvers"],
                    courses: ["Calculus I", "Linear Algebra"],
                    bio: "20+ years teaching mathematics. Known for patient explanations and comprehensive examples.",
                    image: "üë®‚Äçüî¨"
                },
                {
                    name: "Prof. Ke Xin",
                    title: "Associate Professor of Mathematics",
                    specialty: "Advanced Calculus & Mathematical Methods",
                    rating: 4.9,
                    difficulty: "High",
                    teachingStyle: "Rigorous theoretical approach with advanced applications",
                    availability: ["Morning", "Afternoon"],
                    recommendedFor: ["Advanced students", "Theory-focused learners"],
                    courses: ["Calculus II", "Differential Equations"],
                    bio: "Research focus on mathematical modeling. Challenges students to think critically.",
                    image: "üë©‚Äçüéì"
                },
                {
                    name: "Prof. Younes Benkarroum",
                    title: "Assistant Professor of Computer Science",
                    specialty: "Advanced Programming & Algorithms",
                    rating: 4.8,
                    difficulty: "High",
                    teachingStyle: "Project-based learning with industry applications",
                    availability: ["Afternoon", "Evening"],
                    recommendedFor: ["Advanced programmers", "Career-focused students"],
                    courses: ["Advanced Programming Techniques", "Algorithms", "Software Engineering"],
                    bio: "Former software architect. Brings real-world industry experience to the classroom.",
                    image: "üë®‚Äçüíª"
                },
                {
                    name: "Dr. Emily Watson",
                    title: "Professor of AI & Machine Learning",
                    specialty: "AI, ML & Data Science",
                    rating: 4.8,
                    difficulty: "High",
                    teachingStyle: "Theoretical foundations with research applications",
                    availability: ["Morning", "Flexible"],
                    recommendedFor: ["Advanced students", "Research-oriented"],
                    courses: ["Machine Learning", "Artificial Intelligence", "Database Systems"],
                    bio: "PhD from MIT. Published 20+ papers in top AI conferences.",
                    image: "üë©‚Äçüî¨"
                },
                {
                    name: "Prof. James Kim",
                    title: "Assistant Professor",
                    specialty: "Systems & Cybersecurity",
                    rating: 4.6,
                    difficulty: "Medium",
                    teachingStyle: "Hands-on labs and security challenges",
                    availability: ["Afternoon", "Evening"],
                    recommendedFor: ["Hands-on learners", "Career-focused students"],
                    courses: ["Computer Systems", "Operating Systems", "Cybersecurity"],
                    bio: "Former security consultant. Certified Ethical Hacker.",
                    image: "üë®‚Äçüîß"
                },
                {
                    name: "Prof. Maria Rodriguez",
                    title: "Associate Professor",
                    specialty: "Web & Mobile Development",
                    rating: 4.7,
                    difficulty: "Medium",
                    teachingStyle: "Project-based with modern frameworks",
                    availability: ["Afternoon", "Evening"],
                    recommendedFor: ["Creative students", "Front-end developers"],
                    courses: ["Web Development", "Mobile App Development"],
                    bio: "Former front-end lead at tech startup. Passionate about UI/UX design.",
                    image: "üë©‚Äçüíª"
                },
                {
                    name: "Dr. Michael Chen",
                    title: "Professor of Computer Science",
                    specialty: "Cloud Computing & Networks",
                    rating: 4.5,
                    difficulty: "Medium-High",
                    teachingStyle: "Infrastructure-focused with real-world case studies",
                    availability: ["Morning", "Afternoon"],
                    recommendedFor: ["Infrastructure-focused", "Systems thinkers"],
                    courses: ["Cloud Computing", "Computer Networks", "Operating Systems"],
                    bio: "Former cloud architect at AWS. Expert in distributed systems.",
                    image: "üë®‚Äçüî¨"
                }
            ],
            eng: [
                {
                    name: "Dr. Robert Johnson",
                    title: "Professor of Mechanical Engineering",
                    specialty: "Thermodynamics & Fluid Mechanics",
                    rating: 4.8,
                    difficulty: "High",
                    teachingStyle: "Practical applications with lab demonstrations",
                    availability: ["Morning", "Afternoon"],
                    recommendedFor: ["Full-time students", "Visual learners"],
                    courses: ["Engineering Mechanics", "Thermodynamics", "Fluid Mechanics"],
                    bio: "15+ years in automotive industry. Patent holder.",
                    image: "üë®‚Äçüîß"
                },
                {
                    name: "Prof. Amanda Lee",
                    title: "Associate Professor",
                    specialty: "Electrical Engineering & Circuits",
                    rating: 4.7,
                    difficulty: "Medium-High",
                    teachingStyle: "Interactive simulations and circuit design",
                    availability: ["Afternoon", "Evening"],
                    recommendedFor: ["Part-time students", "Hands-on learners"],
                    courses: ["Circuit Analysis", "Control Systems", "Physics II: Electricity"],
                    bio: "Former electronics design engineer. Passionate about renewable energy.",
                    image: "üë©‚Äçüî¨"
                },
                {
                    name: "Dr. David Wilson",
                    title: "Professor of Materials Science",
                    specialty: "Materials & Structural Analysis",
                    rating: 4.6,
                    difficulty: "Medium",
                    teachingStyle: "Case studies with material testing",
                    availability: ["Morning", "Flexible"],
                    recommendedFor: ["Research-oriented", "Detail-focused"],
                    courses: ["Materials Science", "Structural Analysis", "Engineering Design"],
                    bio: "Materials research for aerospace applications.",
                    image: "üë®‚Äçüè≠"
                },
                {
                    name: "Prof. Maria Garcia",
                    title: "Assistant Professor",
                    specialty: "Biomedical Engineering",
                    rating: 4.9,
                    difficulty: "Medium-High",
                    teachingStyle: "Interdisciplinary projects with medical applications",
                    availability: ["Afternoon", "Evening"],
                    recommendedFor: ["Project-focused", "Healthcare interested"],
                    courses: ["Biomedical Engineering", "Engineering Design"],
                    bio: "MD/PhD dual degree. Focus on medical device innovation.",
                    image: "üë©‚Äç‚öïÔ∏è"
                },
                {
                    name: "Prof. Thomas Wright",
                    title: "Professor of Physics",
                    specialty: "Engineering Physics",
                    rating: 4.6,
                    difficulty: "Medium",
                    teachingStyle: "Conceptual understanding with practical applications",
                    availability: ["Morning", "Afternoon"],
                    recommendedFor: ["Conceptual learners", "Physics enthusiasts"],
                    courses: ["Physics I: Mechanics", "Physics II: Electricity"],
                    bio: "20+ years teaching engineering physics. Makes complex concepts accessible.",
                    image: "üë®‚Äçüî¨"
                }
            ]
        };

        // Simplified chatbot steps without teaching style questions
        const chatbotSteps = [
            {
                question: "Welcome to Academic Pathway Quest! Let's personalize your journey. What's your name?",
                type: 'text',
                key: "playerName"
            },
            {
                question: "Nice to meet you! Are you planning to study full-time or part-time?",
                options: ["Full-time (4+ courses per semester)", "Part-time (1-3 courses per semester)"],
                key: "studyType"
            },
            {
                question: "What time of day do you prefer for classes?",
                options: ["Morning (8 AM - 12 PM)", "Afternoon (12 PM - 4 PM)", "Evening (4 PM - 8 PM)", "Flexible (Any time works)"],
                key: "preferredTime"
            },
            {
                question: "How many courses do you plan to take each semester?",
                options: ["1-2 courses", "3-4 courses", "5-6 courses"],
                key: "plannedCourses"
            },
            {
                question: "How many semesters do you plan to complete your degree in?",
                options: ["4 semesters (2 years)", "6 semesters (3 years)", "8 semesters (4 years)"],
                key: "plannedSemesters"
            }
        ];

        function updateStats() {
            const totalXP = state.courses.reduce((sum, c) => sum + (c.completed ? c.credits * c.difficulty * 10 : 0), 0);
            state.xp = totalXP;
            state.level = Math.floor(totalXP / 100) + 1;
            
            // Update actual progress
            state.progress.actualCourses = state.courses.filter(c => c.completed).length;
            state.progress.actualSemesters = Math.max(...state.courses.filter(c => c.completed).map(c => c.semester), 0);
        }

        function generateTeacherRecommendations() {
            if (!state.selectedMajor || !teachers[state.selectedMajor]) return [];
            
            const majorTeachers = teachers[state.selectedMajor];
            const userPreferences = state.chatbot.responses;
            
            // Score teachers based on user preferences
            const scoredTeachers = majorTeachers.map(teacher => {
                let score = 0;
                
                // Match availability
                if (teacher.availability.includes(userPreferences.preferredTime) || 
                    userPreferences.preferredTime === "Flexible (Any time works)") {
                    score += 3;
                }
                
                // Match study type
                if (teacher.recommendedFor.some(rec => 
                    rec.includes(userPreferences.studyType.includes("Full-time") ? "Full-time" : "Part-time"))) {
                    score += 2;
                }
                
                // Add rating as base score
                score += teacher.rating;
                
                return { ...teacher, score };
            });
            
            // Sort by score and return top 3
            return scoredTeachers
                .sort((a, b) => b.score - a.score)
                .slice(0, 3);
        }

        function searchProfessors(query) {
            if (!query.trim()) return [];
            
            const majorTeachers = teachers[state.selectedMajor] || [];
            const lowercaseQuery = query.toLowerCase();
            
            return majorTeachers.filter(teacher => {
                // Search by professor name
                if (teacher.name.toLowerCase().includes(lowercaseQuery)) {
                    return true;
                }
                
                // Search by courses they teach
                if (teacher.courses.some(course => 
                    course.toLowerCase().includes(lowercaseQuery))) {
                    return true;
                }
                
                // Search by specialty
                if (teacher.specialty.toLowerCase().includes(lowercaseQuery)) {
                    return true;
                }
                
                return false;
            });
        }

        function handleProfessorSearch() {
            const query = state.professorSearch.query;
            state.professorSearch.results = searchProfessors(query);
            render();
        }

        function startQuest() {
            if (state.selectedMajor && courseTemplates[state.selectedMajor]) {
                const majorCourses = courseTemplates[state.selectedMajor];
                
                // Select 4 electives for the student
                const selectedElectives = [...majorCourses.electives]
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 4)
                    .map((course, idx) => ({
                        ...course,
                        id: `elective-${idx}`,
                        type: 'elective',
                        completed: false,
                        grade: null,
                    }));

                state.courses = [
                    ...majorCourses.core.map((course, idx) => ({
                        ...course,
                        id: `core-${idx}`,
                        type: 'core',
                        completed: false,
                        grade: null,
                    })),
                    ...selectedElectives
                ];
                
                // Set planned progress based on chatbot responses
                state.progress.plannedCourses = state.chatbot.responses.plannedCourses === "1-2 courses" ? 2 : 
                                              state.chatbot.responses.plannedCourses === "3-4 courses" ? 4 : 6;
                                              
                state.progress.plannedSemesters = state.chatbot.responses.plannedSemesters === "4 semesters (2 years)" ? 4 :
                                                state.chatbot.responses.plannedSemesters === "6 semesters (3 years)" ? 6 : 8;
                
                // Generate teacher recommendations
                state.teacherRecommendations = generateTeacherRecommendations();
                
                state.showSetup = false;
                updateStats();
                render();
            }
        }

        function toggleCourse(id) {
            const course = state.courses.find(c => c.id === id);
            if (course) {
                // Check if prerequisites are met
                const unmetPrerequisites = course.prerequisites.filter(prereq => 
                    !state.courses.find(c => c.name === prereq && c.completed)
                );

                if (unmetPrerequisites.length > 0 && !course.completed) {
                    alert(`Cannot take ${course.name} yet. Complete these prerequisites first: ${unmetPrerequisites.join(', ')}`);
                    return;
                }

                course.completed = !course.completed;
                if (!course.completed) course.grade = null;
                updateStats();
                render();
            }
        }

        function updateGrade(id, grade) {
            const course = state.courses.find(c => c.id === id);
            if (course) {
                course.grade = grade;
                render();
            }
        }

        function getDifficultyStars(difficulty) {
            let stars = '';
            for (let i = 0; i < difficulty; i++) {
                stars += '<svg class="w-3 h-3 inline fill-yellow-400 text-yellow-400" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
            }
            return stars;
        }

        function getGradeColor(grade) {
            if (!grade) return 'bg-gray-700';
            if (grade === 'A' || grade === 'A+') return 'bg-green-600';
            if (grade === 'B+' || grade === 'B') return 'bg-blue-600';
            if (grade === 'C+' || grade === 'C' || grade === 'B-') return 'bg-yellow-600';
            return 'bg-orange-600';
        }

        function handleChatbotResponse(response) {
            const currentStep = chatbotSteps[state.chatbot.currentStep];
            
            if (currentStep.key === 'playerName') {
                state.playerName = response;
            } else {
                state.chatbot.responses[currentStep.key] = response;
            }
            
            if (state.chatbot.currentStep < chatbotSteps.length - 1) {
                state.chatbot.currentStep++;
            } else {
                state.chatbot.completed = true;
            }
            render();
        }

        function renderFlowchart() {
            if (!state.courses.length) return '';
            
            const semesters = [1, 2, 3, 4];
            const completedCourses = state.courses.filter(c => c.completed);
            
            return `
                <div class="bg-slate-800 rounded-xl p-6 border-2 border-purple-500 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">üìä Academic Flowchart</h3>
                        <div class="flex items-center gap-4 text-sm">
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                <span class="text-gray-300">On Track</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                <span class="text-gray-300">Behind Schedule</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                <span class="text-gray-300">Significantly Behind</span>
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <div class="flex gap-4 min-w-max">
                            ${semesters.map(semester => {
                                const semesterCourses = state.courses.filter(c => c.semester === semester);
                                const completedCount = semesterCourses.filter(c => c.completed).length;
                                const plannedCount = state.progress.plannedCourses;
                                
                                // Determine progress status
                                let statusColor = 'bg-green-500';
                                if (completedCount < plannedCount * 0.7) {
                                    statusColor = 'bg-red-500';
                                } else if (completedCount < plannedCount) {
                                    statusColor = 'bg-yellow-500';
                                }
                                
                                return `
                                    <div class="flex flex-col items-center">
                                        <div class="flex items-center gap-2 mb-2">
                                            <div class="text-white font-bold">Semester ${semester}</div>
                                            <div class="w-2 h-2 rounded-full ${statusColor}"></div>
                                        </div>
                                        <div class="bg-slate-700 rounded-lg p-4 min-w-[200px]">
                                            ${semesterCourses.map(course => `
                                                <div class="flowchart-node mb-2 p-2 rounded border-2 ${
                                                    course.completed 
                                                        ? 'border-green-500 bg-green-900/20' 
                                                        : course.prerequisites.every(prereq => 
                                                            state.courses.find(c => c.name === prereq && c.completed)
                                                        ) 
                                                        ? 'border-blue-400 bg-blue-900/20 cursor-pointer hover:bg-blue-900/40'
                                                        : 'border-gray-500 bg-gray-900/20 opacity-50'
                                                }" onclick="${course.prerequisites.every(prereq => 
                                                    state.courses.find(c => c.name === prereq && c.completed)
                                                ) || course.completed ? `toggleCourse('${course.id}')` : ''}">
                                                    <div class="flex justify-between items-center">
                                                        <span class="text-sm text-white ${course.completed ? 'line-through' : ''}">${course.name}</span>
                                                        ${course.type === 'core' ? 'üî¥' : 'üü¢'}
                                                    </div>
                                                    <div class="text-xs text-gray-400 mt-1">${course.credits} credits</div>
                                                    ${course.prerequisites.length > 0 ? `
                                                        <div class="text-xs text-gray-500 mt-1">Req: ${course.prerequisites.join(', ')}</div>
                                                    ` : ''}
                                                </div>
                                            `).join('')}
                                        </div>
                                        <div class="text-sm text-gray-400 mt-2">${completedCount}/${semesterCourses.length} completed</div>
                                        <div class="text-xs text-gray-500 mt-1">Planned: ${plannedCount}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    <div class="flex gap-4 mt-4 text-sm text-gray-400">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-red-500 rounded"></div>
                            <span>Core Course</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-green-500 rounded"></div>
                            <span>Elective</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProgressComparison() {
            const plannedCourses = state.progress.plannedCourses;
            const actualCourses = state.progress.actualCourses;
            const plannedSemesters = state.progress.plannedSemesters;
            const actualSemesters = state.progress.actualSemesters;
            
            // Calculate progress metrics
            const courseProgress = actualCourses / (plannedCourses * plannedSemesters) * 100;
            const semesterProgress = actualSemesters / plannedSemesters * 100;
            
            let progressMessage = "";
            let progressColor = "text-green-400";
            
            if (courseProgress < 70) {
                progressMessage = "You're behind your planned course load. Consider adjusting your schedule.";
                progressColor = "text-yellow-400";
            } else if (courseProgress < 90) {
                progressMessage = "You're making good progress but slightly behind your initial plan.";
                progressColor = "text-orange-400";
            } else {
                progressMessage = "Great job! You're on track with your planned course load.";
            }
            
            return `
                <div class="bg-slate-800 rounded-xl p-6 border-2 border-purple-500 mb-6">
                    <h3 class="text-xl font-bold text-white mb-4">üìà Progress Comparison</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-lg font-semibold text-white mb-2">Course Load</h4>
                            <div class="flex justify-between text-sm text-gray-400 mb-2">
                                <span>Planned: ${plannedCourses} courses/semester</span>
                                <span>Actual: ${(actualCourses / Math.max(actualSemesters, 1)).toFixed(1)} courses/semester</span>
                            </div>
                            <div class="w-full bg-slate-600 rounded-full h-4 overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-green-500 to-emerald-400 transition-all duration-500 flex items-center justify-end pr-2" style="width: ${Math.min(courseProgress, 100)}%">
                                    ${courseProgress > 10 ? `<span class="text-xs font-bold text-white">${Math.round(courseProgress)}%</span>` : ''}
                                </div>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold text-white mb-2">Semester Progress</h4>
                            <div class="flex justify-between text-sm text-gray-400 mb-2">
                                <span>Planned: ${plannedSemesters} semesters</span>
                                <span>Current: Semester ${actualSemesters}</span>
                            </div>
                            <div class="w-full bg-slate-600 rounded-full h-4 overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-blue-500 to-cyan-400 transition-all duration-500 flex items-center justify-end pr-2" style="width: ${Math.min(semesterProgress, 100)}%">
                                    ${semesterProgress > 10 ? `<span class="text-xs font-bold text-white">${Math.round(semesterProgress)}%</span>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-slate-700 rounded-lg">
                        <p class="${progressColor} text-sm">${progressMessage}</p>
                    </div>
                </div>
            `;
        }

        function renderTeacherRecommendations() {
            if (state.teacherRecommendations.length === 0) return '';
            
            return `
                <div class="bg-slate-800 rounded-xl p-6 border-2 border-purple-500 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-white">üë®‚Äçüè´ Recommended Instructors</h3>
                        <button
                            onclick="state.professorSearch.active = true; render();"
                            class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all"
                        >
                            üîç Search More Professors
                        </button>
                    </div>
                    <p class="text-gray-300 mb-4">Based on your study preferences, we recommend these instructors:</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        ${state.teacherRecommendations.map(teacher => `
                            <div class="bg-slate-700 rounded-lg p-4 border border-slate-600 hover:border-purple-400 transition-all">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="text-3xl">${teacher.image}</div>
                                    <div>
                                        <h4 class="text-white font-bold">${teacher.name}</h4>
                                        <p class="text-gray-400 text-sm">${teacher.title}</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2 mb-2">
                                    <div class="flex text-yellow-400">
                                        ${'‚òÖ'.repeat(Math.floor(teacher.rating))}${teacher.rating % 1 >= 0.5 ? '¬Ω' : ''}
                                    </div>
                                    <span class="text-gray-400 text-sm">${teacher.rating}/5.0</span>
                                </div>
                                <div class="mb-3">
                                    <span class="text-xs px-2 py-1 rounded-full bg-blue-500 text-white">${teacher.specialty}</span>
                                    <span class="text-xs px-2 py-1 rounded-full bg-purple-500 text-white ml-1">${teacher.difficulty}</span>
                                </div>
                                <p class="text-gray-300 text-sm mb-3">${teacher.bio}</p>
                                <div class="text-xs text-gray-400">
                                    <p class="font-semibold">Teaching Style:</p>
                                    <p>${teacher.teachingStyle}</p>
                                    <p class="mt-2 font-semibold">Available:</p>
                                    <p>${teacher.availability.join(', ')}</p>
                                    <p class="mt-2 font-semibold">Courses:</p>
                                    <p>${teacher.courses.slice(0, 3).join(', ')}${teacher.courses.length > 3 ? '...' : ''}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderProfessorSearch() {
            return `
                <div class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
                    <div class="bg-slate-800 rounded-xl p-6 border-2 border-purple-500 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">üîç Search Professors</h3>
                            <button
                                onclick="state.professorSearch.active = false; state.professorSearch.query = ''; state.professorSearch.results = []; render();"
                                class="text-gray-400 hover:text-white text-2xl"
                            >
                                √ó
                            </button>
                        </div>
                        
                        <div class="mb-6">
                            <div class="flex gap-2">
                                <input
                                    type="text"
                                    id="professorSearchInput"
                                    placeholder="Search by professor name, course, or specialty..."
                                    class="flex-1 p-3 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-purple-400"
                                    value="${state.professorSearch.query}"
                                    oninput="state.professorSearch.query = this.value; handleProfessorSearch();"
                                    onkeyup="if(event.key === 'Enter') handleProfessorSearch()"
                                />
                                <button
                                    onclick="handleProfessorSearch()"
                                    class="px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all"
                                >
                                    Search
                                </button>
                            </div>
                            <p class="text-gray-400 text-sm mt-2">
                                Search for professors by name, courses they teach, or their specialties
                            </p>
                        </div>
                        
                        <div>
                            <h4 class="text-lg font-semibold text-white mb-4">
                                ${state.professorSearch.results.length} Professor${state.professorSearch.results.length !== 1 ? 's' : ''} Found
                            </h4>
                            
                            ${state.professorSearch.results.length === 0 ? `
                                <div class="text-center py-8">
                                    <div class="text-4xl mb-4">üîç</div>
                                    <p class="text-gray-400">No professors found matching your search.</p>
                                    <p class="text-gray-500 text-sm mt-2">Try searching by name, course, or specialty</p>
                                </div>
                            ` : `
                                <div class="space-y-4">
                                    ${state.professorSearch.results.map(teacher => `
                                        <div class="bg-slate-700 rounded-lg p-4 border border-slate-600 hover:border-purple-400 transition-all">
                                            <div class="flex items-center gap-3 mb-3">
                                                <div class="text-2xl">${teacher.image}</div>
                                                <div class="flex-1">
                                                    <h4 class="text-white font-bold">${teacher.name}</h4>
                                                    <p class="text-gray-400 text-sm">${teacher.title}</p>
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <div class="flex text-yellow-400">
                                                        ${'‚òÖ'.repeat(Math.floor(teacher.rating))}${teacher.rating % 1 >= 0.5 ? '¬Ω' : ''}
                                                    </div>
                                                    <span class="text-gray-400 text-sm">${teacher.rating}</span>
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <span class="text-xs px-2 py-1 rounded-full bg-blue-500 text-white">${teacher.specialty}</span>
                                                <span class="text-xs px-2 py-1 rounded-full bg-purple-500 text-white ml-1">${teacher.difficulty}</span>
                                            </div>
                                            <p class="text-gray-300 text-sm mb-3">${teacher.bio}</p>
                                            <div class="text-xs text-gray-400">
                                                <p class="font-semibold">Teaching Style:</p>
                                                <p>${teacher.teachingStyle}</p>
                                                <p class="mt-2 font-semibold">Available:</p>
                                                <p>${teacher.availability.join(', ')}</p>
                                                <p class="mt-2 font-semibold">Courses:</p>
                                                <p>${teacher.courses.join(', ')}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderChatbot() {
            if (!state.chatbot.active) return '';
            
            const currentStep = chatbotSteps[state.chatbot.currentStep];
            
            return `
                <div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4 md:p-8 flex items-center justify-center">
                    <div class="max-w-2xl w-full">
                        <div class="text-center mb-8">
                            <div class="inline-block p-4 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full mb-4">
                                <svg class="w-12 h-12 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                            </div>
                            <h1 class="text-3xl font-bold text-white mb-2">Academic Pathway Quest</h1>
                            <p class="text-gray-300">Let's personalize your academic journey</p>
                        </div>

                        <div class="bg-slate-800 rounded-2xl p-6 border-2 border-purple-500">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                                    <span class="text-white font-bold text-lg">AI</span>
                                </div>
                                <div>
                                    <h3 class="text-white font-bold text-lg">Study Advisor</h3>
                                    <p class="text-gray-400">Step ${state.chatbot.currentStep + 1} of ${chatbotSteps.length}</p>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="bg-slate-700 rounded-lg p-4 animate-slideIn">
                                    <p class="text-white mb-4 text-lg">${currentStep.question}</p>
                                    
                                    ${currentStep.type === 'text' ? `
                                        <div class="flex gap-2">
                                            <input
                                                type="text"
                                                id="chatbotInput"
                                                class="flex-1 p-3 bg-slate-600 border border-slate-500 rounded-lg text-white focus:outline-none focus:border-purple-400"
                                                placeholder="Type your answer..."
                                                onkeypress="if(event.key === 'Enter') handleChatbotResponse(document.getElementById('chatbotInput').value)"
                                            />
                                            <button
                                                onclick="handleChatbotResponse(document.getElementById('chatbotInput').value)"
                                                class="px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all"
                                            >
                                                Continue
                                            </button>
                                        </div>
                                    ` : `
                                        <div class="space-y-2">
                                            ${currentStep.options.map(option => `
                                                <button
                                                    onclick="handleChatbotResponse('${option}')"
                                                    class="w-full text-left p-4 bg-slate-600 hover:bg-slate-500 rounded-lg text-white transition-all transform hover:scale-102"
                                                >
                                                    ${option}
                                                </button>
                                            `).join('')}
                                        </div>
                                    `}
                                </div>
                                
                                ${state.chatbot.completed ? `
                                    <div class="bg-green-600 rounded-lg p-4 animate-fadeIn">
                                        <p class="text-white font-semibold text-center">üéâ Perfect! Now choose your major to begin your quest!</p>
                                        <div class="mt-2 text-white text-sm text-center">
                                            <p>Based on your preferences:</p>
                                            <p>‚Ä¢ ${state.chatbot.responses.studyType}</p>
                                            <p>‚Ä¢ ${state.chatbot.responses.preferredTime}</p>
                                            <p>‚Ä¢ ${state.chatbot.responses.plannedCourses} per semester</p>
                                            <p>‚Ä¢ ${state.chatbot.responses.plannedSemesters}</p>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                        ${majors.map(major => `
                                            <button
                                                onclick="state.selectedMajor = '${major.id}'; startQuest();"
                                                class="p-4 rounded-xl border-2 transition-all transform hover:scale-105 text-left bg-slate-700 border-slate-600 hover:border-purple-400"
                                            >
                                                <div class="text-2xl mb-2">${major.icon}</div>
                                                <div class="text-white font-semibold">${major.name}</div>
                                                <div class="text-gray-300 text-sm mt-1">${major.description}</div>
                                            </button>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSetup() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4 md:p-8">
                    <div class="max-w-4xl mx-auto">
                        <div class="text-center mb-8 md:mb-12 animate-float">
                            <div class="inline-block p-4 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full mb-4 shadow-lg">
                                <svg class="w-12 h-12 md:w-16 md:h-16 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                                    <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                                    <path d="M4 22h16"></path>
                                    <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
                                    <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
                                    <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
                                </svg>
                            </div>
                            <h1 class="text-3xl md:text-5xl font-bold text-white mb-2 md:mb-4">Academic Pathway Quest</h1>
                            <p class="text-lg md:text-xl text-gray-300">Level up your education journey!</p>
                        </div>

                        <div class="bg-slate-800 rounded-xl md:rounded-2xl p-6 md:p-8 shadow-2xl border border-purple-500 animate-fadeIn">
                            <button
                                onclick="state.chatbot.active = true; render();"
                                class="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-lg font-bold rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all transform hover:scale-105 mb-6"
                            >
                                üéØ Start with Personalized Guidance
                            </button>
                            
                            <div class="mb-6 md:mb-8">
                                <label class="block text-white text-lg font-semibold mb-4">
                                    Or choose your major directly:
                                </label>
                                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 md:gap-4">
                                    ${majors.map(major => `
                                        <button
                                            onclick="state.selectedMajor = '${major.id}'; state.playerName = 'Student'; state.chatbot.responses.studyType = 'Full-time'; state.chatbot.responses.plannedCourses = '3-4 courses'; state.chatbot.responses.plannedSemesters = '4 semesters (2 years)'; startQuest();"
                                            class="p-4 md:p-6 rounded-xl border-2 transition-all transform hover:scale-105 text-left bg-slate-700 border-slate-600 hover:border-purple-400"
                                        >
                                            <div class="text-3xl md:text-4xl mb-2">${major.icon}</div>
                                            <div class="text-white font-semibold text-base md:text-lg">${major.name}</div>
                                            <div class="text-gray-300 text-xs md:text-sm mt-1">${major.description}</div>
                                        </button>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMain() {
            const completedCourses = state.courses.filter(c => c.completed).length;
            const totalCourses = state.courses.length;
            const progressPercentage = Math.round((completedCourses / totalCourses) * 100);
            
            return `
                <div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4 md:p-8">
                    <div class="max-w-7xl mx-auto">
                        <!-- Header -->
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 md:mb-8 gap-4">
                            <div>
                                <h1 class="text-2xl md:text-4xl font-bold text-white">Academic Pathway Quest</h1>
                                <p class="text-gray-300">${state.playerName}'s ${majors.find(m => m.id === state.selectedMajor)?.name || 'Academic'} Journey</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="bg-slate-800 rounded-lg p-3 md:p-4 border border-purple-500">
                                    <div class="text-white font-bold text-lg md:text-xl">Level ${state.level}</div>
                                    <div class="text-gray-400 text-sm">${state.xp} XP</div>
                                </div>
                                <button
                                    onclick="state.showSetup = true; state.courses = []; render();"
                                    class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-all"
                                >
                                    Restart
                                </button>
                            </div>
                        </div>

                        <!-- Progress Overview -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-6 md:mb-8">
                            <div class="bg-slate-800 rounded-xl p-4 md:p-6 border-2 border-blue-500">
                                <div class="text-blue-400 text-sm md:text-base font-semibold">Courses Completed</div>
                                <div class="text-white text-2xl md:text-3xl font-bold mt-2">${completedCourses}/${totalCourses}</div>
                                <div class="w-full bg-slate-700 rounded-full h-2 md:h-3 mt-2">
                                    <div class="h-full bg-gradient-to-r from-blue-500 to-cyan-400 rounded-full transition-all duration-500" style="width: ${progressPercentage}%"></div>
                                </div>
                            </div>
                            <div class="bg-slate-800 rounded-xl p-4 md:p-6 border-2 border-green-500">
                                <div class="text-green-400 text-sm md:text-base font-semibold">Credits Earned</div>
                                <div class="text-white text-2xl md:text-3xl font-bold mt-2">
                                    ${state.courses.filter(c => c.completed).reduce((sum, c) => sum + c.credits, 0)}
                                </div>
                                <div class="text-gray-400 text-sm mt-1">of ${state.courses.reduce((sum, c) => sum + c.credits, 0)} required</div>
                            </div>
                            <div class="bg-slate-800 rounded-xl p-4 md:p-6 border-2 border-purple-500">
                                <div class="text-purple-400 text-sm md:text-base font-semibold">GPA Estimate</div>
                                <div class="text-white text-2xl md:text-3xl font-bold mt-2">
                                    ${(() => {
                                        const gradedCourses = state.courses.filter(c => c.grade);
                                        if (gradedCourses.length === 0) return 'N/A';
                                        const gradePoints = gradedCourses.reduce((sum, c) => {
                                            const points = { 'A+': 4.0, 'A': 4.0, 'A-': 3.7, 'B+': 3.3, 'B': 3.0, 'B-': 2.7, 'C+': 2.3, 'C': 2.0, 'C-': 1.7, 'D+': 1.3, 'D': 1.0, 'F': 0.0 }[c.grade] || 0;
                                            return sum + points;
                                        }, 0);
                                        return (gradePoints / gradedCourses.length).toFixed(2);
                                    })()}
                                </div>
                                <div class="text-gray-400 text-sm mt-1">based on ${state.courses.filter(c => c.grade).length} graded courses</div>
                            </div>
                        </div>

                        <!-- Teacher Recommendations -->
                        ${renderTeacherRecommendations()}

                        <!-- Progress Comparison -->
                        ${renderProgressComparison()}

                        <!-- Flowchart -->
                        ${renderFlowchart()}

                        <!-- Course List -->
                        <div class="bg-slate-800 rounded-xl p-6 border-2 border-purple-500">
                            <h3 class="text-xl font-bold text-white mb-4">üìö Your Courses</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${state.courses.map(course => `
                                    <div class="course-card bg-slate-700 rounded-lg p-4 border-2 ${course.completed ? 'border-green-500' : 'border-slate-600'} hover:border-purple-400 transition-all">
                                        <div class="flex justify-between items-start mb-2">
                                            <h4 class="text-white font-semibold ${course.completed ? 'line-through' : ''}">${course.name}</h4>
                                            <div class="flex items-center gap-2">
                                                <span class="text-xs px-2 py-1 rounded-full ${course.type === 'core' ? 'bg-red-500' : 'bg-green-500'} text-white">
                                                    ${course.type === 'core' ? 'Core' : 'Elective'}
                                                </span>
                                                <span class="text-xs px-2 py-1 rounded-full bg-blue-500 text-white">
                                                    ${course.credits} credits
                                                </span>
                                            </div>
                                        </div>
                                        <p class="text-gray-300 text-sm mb-3">${course.description}</p>
                                        <div class="flex justify-between items-center mb-3">
                                            <div class="text-yellow-400 text-sm">
                                                ${getDifficultyStars(course.difficulty)}
                                            </div>
                                            <div class="text-gray-400 text-sm">
                                                Semester ${course.semester}
                                            </div>
                                        </div>
                                        ${course.prerequisites.length > 0 ? `
                                            <div class="text-xs text-gray-500 mb-3">
                                                Prerequisites: ${course.prerequisites.join(', ')}
                                            </div>
                                        ` : ''}
                                        <div class="flex justify-between items-center">
                                            <button
                                                onclick="toggleCourse('${course.id}')"
                                                class="px-4 py-2 rounded-lg ${course.completed ? 'bg-orange-500 hover:bg-orange-600' : 'bg-green-500 hover:bg-green-600'} text-white transition-all"
                                            >
                                                ${course.completed ? 'Mark Incomplete' : 'Mark Complete'}
                                            </button>
                                            ${course.completed ? `
                                                <div class="flex gap-1">
                                                    ${['A+', 'A', 'A-', 'B+', 'B', 'B-', 'C+', 'C', 'C-', 'D+', 'D', 'F'].map(grade => `
                                                        <button
                                                            onclick="updateGrade('${course.id}', '${grade}')"
                                                            class="grade-btn w-8 h-8 rounded text-xs font-bold ${course.grade === grade ? getGradeColor(grade) : 'bg-slate-600 hover:bg-slate-500'} text-white transition-all"
                                                        >
                                                            ${grade}
                                                        </button>
                                                    `).join('')}
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    ${state.professorSearch.active ? renderProfessorSearch() : ''}
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            
            if (state.chatbot.active && !state.chatbot.completed) {
                app.innerHTML = renderChatbot();
                // Focus on input if it exists
                const input = document.getElementById('chatbotInput');
                if (input) input.focus();
            } else if (state.showSetup) {
                app.innerHTML = renderSetup();
            } else {
                app.innerHTML = renderMain();
                
                // Focus on search input when search modal is active
                if (state.professorSearch.active) {
                    setTimeout(() => {
                        const searchInput = document.getElementById('professorSearchInput');
                        if (searchInput) {
                            searchInput.focus();
                            // Set cursor to end of input to fix backwards typing
                            searchInput.setSelectionRange(searchInput.value.length, searchInput.value.length);
                        }
                    }, 100);
                }
            }
        }

        // Initialize the app
        render();
    </script>
</body>
</html>

